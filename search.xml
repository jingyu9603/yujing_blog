<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>使用biomaRT转换ID</title>
      <link href="/2019/06/06/%E4%BD%BF%E7%94%A8biomaRT%E8%BD%AC%E6%8D%A2ID/"/>
      <url>/2019/06/06/%E4%BD%BF%E7%94%A8biomaRT%E8%BD%AC%E6%8D%A2ID/</url>
      
        <content type="html"><![CDATA[<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(biomaRt)</span><br><span class="line"><span class="comment">#显示包含的数据库及其版本</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>显示包含的数据库及其版本,</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; listMarts()</span><br><span class="line">               biomart               version</span><br><span class="line"><span class="number">1</span> ENSEMBL_MART_ENSEMBL      Ensembl Genes <span class="number">94</span></span><br><span class="line"><span class="number">2</span>   ENSEMBL_MART_MOUSE      Mouse strains <span class="number">94</span></span><br><span class="line"><span class="number">3</span>     ENSEMBL_MART_SNP  Ensembl Variation <span class="number">94</span></span><br><span class="line"><span class="number">4</span> ENSEMBL_MART_FUNCGEN Ensembl Regulation <span class="number">94</span></span><br></pre></td></tr></table></figure><p>本次使用选用ENSEMBL_MART_ENSEMBL这个数据库</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ensembl</span>=useMart(<span class="string">"ENSEMBL_MART_ENSEMBL"</span>)</span><br></pre></td></tr></table></figure><p>显示该数据库包含的子数据库</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head(<span class="name">listDatasets</span>(<span class="name">ensembl</span>))</span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">47 </span>           ggallus_gene_ensembl</span><br><span class="line"><span class="symbol">48 </span>          ggorilla_gene_ensembl</span><br><span class="line"><span class="symbol">49 </span>           gmorhua_gene_ensembl</span><br><span class="line"><span class="symbol">50 </span>          hburtoni_gene_ensembl</span><br><span class="line"><span class="symbol">51 </span>            hcomes_gene_ensembl</span><br><span class="line"><span class="symbol">52 </span>           hfemale_gene_ensembl</span><br><span class="line"><span class="symbol">53 </span>             hmale_gene_ensembl</span><br><span class="line"><span class="symbol">54 </span>          hsapiens_gene_ensembl</span><br></pre></td></tr></table></figure><p>选择查询的数据库及其相关数据集</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ensembl&lt;-useDataset(<span class="string">"hsapiens_gene_ensembl"</span>,<span class="attribute">mart</span>=ensembl)</span><br></pre></td></tr></table></figure><p>查询filter函数包含的属性，这里filter函数代表的输入（即已知信息）的属性</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filters&lt;-listFilters(<span class="name">ensembl</span>)</span><br><span class="line">head(<span class="name">filters</span>)</span><br></pre></td></tr></table></figure><p>显示attributes函数的属性，这里attributes函数要选择需要查询的属性</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">attributes&lt;-listAttributes(<span class="name">ensembl</span>)</span><br><span class="line">head(<span class="name">attributes</span>)</span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                           name                  description         page</span><br><span class="line">1               ensembl_gene_id               Gene stable ID feature_page</span><br><span class="line">2       ensembl_gene_id_version       Gene stable ID version feature_page</span><br><span class="line">3         ensembl_transcript_id         Transcript stable ID feature_page</span><br><span class="line">4 ensembl_transcript_id_version Transcript stable ID version feature_page</span><br><span class="line">5            ensembl_peptide_id            Protein stable ID feature_page</span><br><span class="line">6    ensembl_peptide_id_version    Protein stable ID version feature_page</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rownames_old=rownames(Pt_union_20)</span><br><span class="line"><span class="comment">##去掉id后面的小数点，也就是版本号</span></span><br><span class="line">ens=c()</span><br><span class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> rownames_old)&#123;</span><br><span class="line">  ens[i]=strsplit(i,<span class="string">"\\."</span>)[[<span class="number">1</span>]][<span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line">names(ens)&lt;-<span class="literal">NULL</span></span><br><span class="line"><span class="comment">#利用getBM()函数进行ID转换</span></span><br><span class="line">gene_symbol=getBM(attributes = c(<span class="string">"ensembl_transcript_id"</span>,<span class="string">"hgnc_symbol"</span>),filters = <span class="string">"ensembl_transcript_id"</span>,values = ens,mart=ensembl)</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##将ID转换过程中，在数据库中没有找到对应ID的空白值转换为“none字符”</span></span><br><span class="line"><span class="keyword">for</span>(j <span class="keyword">in</span> which(gene_symbol[,<span class="number">2</span>]==<span class="string">""</span>))&#123;</span><br><span class="line">  gene_symbol[j,<span class="number">2</span>]=<span class="string">"none"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将ID与genesymbol连起来，形成新的ID</span></span><br><span class="line">rownames_new=c()</span><br><span class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> rownames_old)&#123;</span><br><span class="line">  trs_id=strsplit(i,<span class="string">"\\."</span>)[[<span class="number">1</span>]][<span class="number">1</span>]</span><br><span class="line">  print(trs_id)</span><br><span class="line">  index=match(trs_id,gene_symbol$ensembl_transcript_id)</span><br><span class="line">  print(index)</span><br><span class="line">  rownames_new[i]&lt;-paste(i,gene_symbol[index,<span class="number">2</span>],sep=<span class="string">","</span>)</span><br><span class="line">&#125;</span><br><span class="line">names(rownames_new)&lt;-<span class="literal">NULL</span></span><br></pre></td></tr></table></figure><p>当需要转换的id中既有gene_id又有transcrption_id时，可以采用以下的方法：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">rownames_old</span>=rownames(Pt_union_top100)</span><br><span class="line"><span class="attribute">g_id</span>=c()</span><br><span class="line"><span class="attribute">t_id</span>=c()</span><br><span class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> rownames_old)&#123;</span><br><span class="line">  <span class="attribute">id</span>=strsplit(i,"\\.")[[1]][1]</span><br><span class="line">  <span class="keyword">if</span>(grepl(<span class="string">"G"</span>,id))&#123;</span><br><span class="line">    g_id[i]=id</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    t_id[i]=id</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">names(g_id)&lt;-NULL</span><br><span class="line">names(t_id)&lt;-NULL</span><br><span class="line"></span><br><span class="line"><span class="attribute">gene_symbol_t</span>=getBM(attributes = c(<span class="string">"ensembl_transcript_id"</span>,<span class="string">"hgnc_symbol"</span>),filters = <span class="string">"ensembl_transcript_id"</span>,values = t_id,<span class="attribute">mart</span>=ensembl)</span><br><span class="line"><span class="attribute">gene_symbol_g</span>=getBM(attributes = c(<span class="string">"ensembl_gene_id"</span>,<span class="string">"hgnc_symbol"</span>),<span class="attribute">filters</span>=<span class="string">"ensembl_gene_id"</span>,values = g_id,<span class="attribute">mart</span>=ensembl)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(j <span class="keyword">in</span> which(gene_symbol_t[,2]==<span class="string">""</span>))&#123;</span><br><span class="line">  gene_symbol_t[j,2]=<span class="string">"none"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(j <span class="keyword">in</span> which(gene_symbol_g[,2]==<span class="string">""</span>))&#123;</span><br><span class="line">  gene_symbol_g[j,2]=<span class="string">"none"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">rownames_new</span>=c()</span><br><span class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> rownames_old)&#123;</span><br><span class="line">  <span class="attribute">trs_id</span>=strsplit(i,"\\.")[[1]][1]</span><br><span class="line">  <span class="builtin-name">print</span>(trs_id)</span><br><span class="line">  <span class="keyword">if</span>(grepl(<span class="string">"G"</span>,trs_id))&#123;</span><br><span class="line">    <span class="attribute">index</span>=match(trs_id,gene_symbol_g$ensembl_gene_id)</span><br><span class="line">    rownames_new[i]&lt;-paste(i,gene_symbol_g[index,2],<span class="attribute">sep</span>=<span class="string">";"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="attribute">index</span>=match(trs_id,gene_symbol_t$ensembl_transcript_id)</span><br><span class="line">    rownames_new[i]&lt;-paste(i,gene_symbol_t[index,2],<span class="attribute">sep</span>=<span class="string">";"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">names(rownames_new)&lt;-NULL</span><br><span class="line">rownames(Pt_union_top100)&lt;-rownames_new</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> biomaRT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用Hexo+Netlify搭建个人博客</title>
      <link href="/2019/06/06/%E4%BD%BF%E7%94%A8Hexo+Netlify%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
      <url>/2019/06/06/%E4%BD%BF%E7%94%A8Hexo+Netlify%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</url>
      
        <content type="html"><![CDATA[<h4 id="个人博客搭建"><a href="#个人博客搭建" class="headerlink" title="个人博客搭建"></a>个人博客搭建</h4><h5 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h5><p>需要安装Git和Node.js  </p><ul><li><a href="https://git-scm.com/downloads" target="_blank" rel="noopener">Git</a>的安装  </li></ul><p>下载windows最新版，Git-2.21.0-64-bit.exe，<br>在git使用过程中遇到下面的两个错误<br>1、git报错：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fatal: bad<span class="built_in"> config </span>line 1 <span class="keyword">in</span> file C:/Users/JIANGXIAOLIANG/.gitconfig</span><br></pre></td></tr></table></figure><p>解决方案：<br>找到提示的目录，然后删掉.gitconfig文件<br>然后在重新配置用户名和邮箱，输入下面的命令：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git<span class="built_in"> config </span>--global user.name <span class="string">"用户名"</span></span><br><span class="line">$ git<span class="built_in"> config </span>--global user.email <span class="string">"邮箱"</span></span><br></pre></td></tr></table></figure><p>我在使用的时候没有重新配置用户好像也可以正常使用  </p><a id="more"></a><p>2、使用hexo 创建目录时</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">C:</span>\Users\Administrator&gt;hexo init <span class="string">F:</span>/blog</span><br><span class="line">INFO  Cloning hexo-starter <span class="string">https:</span><span class="comment">//github.com/hexojs/hexo-starter.git</span></span><br><span class="line">Cloning into <span class="string">'F:\blog'</span>...</span><br><span class="line"><span class="string">fatal:</span> unable to access <span class="string">'https://github.com/hexojs/hexo-starter.git/'</span>: error setting certificate verify <span class="string">locations:</span></span><br><span class="line"><span class="symbol">  CAfile:</span> <span class="string">E:</span><span class="regexp">/Using Software/</span>Git<span class="regexp">/mingw32/</span>ssl<span class="regexp">/certs/</span>ca-bundle.crt</span><br><span class="line"><span class="symbol">  CApath:</span> none</span><br><span class="line">WARN  git clone failed. Copying data instead</span><br><span class="line">WARN  Failed to install dependencies. Please run <span class="string">'npm install'</span> manually!</span><br></pre></td></tr></table></figure><p>解决方案</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git<span class="built_in"> config </span>--system http.sslverify <span class="literal">false</span></span><br></pre></td></tr></table></figure><ul><li><a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">Node.js</a>的安装  </li></ul><p>在官网下载最新版本的<code>node-v10.16.0-x64.msi</code>，像安装一般软件一样安装Node.js,在安装完以后，将<code>Node</code>的路径添加到计算的环境变量中，然后验证Node.js的版本</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;<span class="keyword">node</span> <span class="title">--version</span></span><br><span class="line">v10.<span class="number">16.0</span></span><br></pre></td></tr></table></figure><h5 id="安装Hexo"><a href="#安装Hexo" class="headerlink" title="安装Hexo"></a>安装Hexo</h5><p>打开git软件下的<code>git-bash.exe</code>终端，在终端中使用npm安装Hexo</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-<span class="keyword">cli</span></span><br></pre></td></tr></table></figure><p>安装完成后创建项目文件夹</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo init F:<span class="string">/blog</span></span><br><span class="line"><span class="comment"># 进入刚刚创建的文件夹</span></span><br><span class="line"><span class="keyword">cd</span> F:<span class="string">/blog</span></span><br></pre></td></tr></table></figure><h5 id="建站"><a href="#建站" class="headerlink" title="建站"></a>建站</h5><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通过npm完成Hexo初始化</span></span><br><span class="line">npm install</span><br><span class="line"><span class="comment">#网站的雏形已经建好了，可以通过hexo服务器来预览成果</span></span><br><span class="line">hexo server</span><br><span class="line"><span class="comment"># 可以前往 http://localhost:4000/ 访问刚刚建立的最新网站</span></span><br><span class="line"><span class="comment"># 新建博客文章</span></span><br><span class="line">hexo new “我的最新日志”</span><br><span class="line"><span class="comment"># 此时已经可以发现在文件夹./source/_posts下面多了一个我的最新日志.md文件</span></span><br><span class="line"><span class="comment">#下一步，生产静态文件</span></span><br><span class="line">hexo generate</span><br><span class="line"><span class="comment"># 如果hexo服务器还在运行中的话，刷新网页，可以看见刚刚创建的博客文章</span></span><br></pre></td></tr></table></figure><h5 id="网站发布前的准备工作"><a href="#网站发布前的准备工作" class="headerlink" title="网站发布前的准备工作"></a>网站发布前的准备工作</h5><p>有一个细节值得一提，在默认情况下，Hexo将生成的网站内容存储至public文件夹。鉴于我们不需要对该文件夹的内容进行版本控制，我们可将该文件夹添加至.gitignore文档中:</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="string">"/public"</span> <span class="meta">&gt;&gt; </span>.gitignore</span><br></pre></td></tr></table></figure><p>接下来将内容推送到习惯使用的代码托管服务，一般将其托管到GitHub<br>新建仓库</p><p>首先，在GitHub上新建仓库。为了避免出错，在新建仓库时，请不要在创建Initialize this repository with a README前打勾，Add .gitignore和Add a license处请选择None。</p><p>鉴于我们的demo基于Hexo和Netlify，在Repository name处填写hexo_netlify来命名仓库。</p><p>打开你的电脑终端，切换至你的项目所在的本地文件夹路径：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cd /F/blog</span><br><span class="line"><span class="comment"># 初始化仓库</span></span><br><span class="line">git init</span><br><span class="line"><span class="comment"># 该命令将创建一个名为.git的子目录，其中包含了你初始化的Git仓库中所需的文件，这些文件是Git仓库的核心。此时，我们仅作了一个初始化的操作，你的项目文件还未被跟踪。  </span></span><br><span class="line"><span class="comment"># 通过git add 来实现对指定文件的跟踪，然后执行git commit提交:</span></span><br><span class="line">git <span class="keyword">add</span><span class="bash"> .</span></span><br><span class="line">git commit -m <span class="string">"initial commit"</span></span><br><span class="line"><span class="comment"># 回到之前我们创建GitHub仓库完成的页面，复制远程仓库链接，在终端输入</span></span><br><span class="line">git remote <span class="keyword">add</span><span class="bash"> origin git@github.com:jingyu9603/hexo_netlify.git</span></span><br><span class="line">用以下指令推送本地仓库内容至GitHub</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure><p>在上一步的使用中可能出现：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -T git@github.com</span><br><span class="line">git@github<span class="selector-class">.com</span>: Permission denied (publickey).</span><br></pre></td></tr></table></figure><p>解决方法</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 创建密钥</span><br><span class="line">ssh-keygen -t rsa -<span class="keyword">b</span> <span class="number">4096</span> -C  <span class="string">"11yj3312@gmail.com"</span></span><br><span class="line"># 当出现“Enter <span class="keyword">a</span> <span class="keyword">file</span> in which <span class="keyword">to</span> save the key”，按回车键就可以了；出现“nter passphrase (<span class="built_in">empty</span> <span class="keyword">for</span> <span class="keyword">no</span> passphrase)”，也是按回车就可以了</span><br><span class="line"># 开启ssh-agent</span><br><span class="line"><span class="built_in">eval</span> $(ssh-agent -s)</span><br><span class="line"># 添加密钥到ssh中</span><br><span class="line"> ssh-<span class="built_in">add</span> ~/.ssh/id_rsa</span><br><span class="line"># 将密钥添加到github的ssh中,复制id_rsa.pub中的内容添加到github <span class="built_in">count</span> setting的SSH <span class="built_in">and</span> GPG <span class="built_in">keys</span> 中</span><br><span class="line">$ <span class="keyword">cat</span> /<span class="keyword">c</span>/Users/Administrator/.ssh/id_rsa.pub</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC5piJ696hRcYzvP0OsGdJHXK+OM1fqUMN2cNSlQJ3GbJYnZn2yuJ5+NTy+tXXtieuqmI4m0b7kB1z0kat8i5r/ML9yk8lvIDekZlKBIiSoW8WcgOGr+mhsJJ6tcCwMOXNOcSYA3dI6lQh+ElVbpRyIffr0jhxZVSH792bxcr6FTu8lh0YvHZD0k/N6NcsrZt6yklFJH+o4yB/mxRdkzdAANNI6TuJad+Jght51Djcsd3lY+<span class="number">4</span>tGqRTYSpohYrLofKREvE9+ZxyWv+Nsf+C9I/CTF6h0J14XRnJo7KNx1sXVsVsmBru5BN0rm0M1IuevbJjmJNsWoT6TYICD2WE6tAgigbvjAx5eCZLdqYXmP8J9TqvXI/heQvKU9BhfJETu8ewij8mWA1vrneorNiofQ9ZiIH0OC5sxJQQWL380GeCvzvP4DTJTj+g8GXvmwW/FnPOEVqliE3nKjzg9GghjBzNu1RHSxl5DxBWi+Rkj0vuQYqmbZ1xDEnrI2fD3GLBFu/ew8jZ/lw7Lk2VSA0oDIaFEhWg9wxSh0j8uUqC6RcSF4idpqIwFYCu8Gu1oP0swEkYc/vsIA5P1aPuqeYrUwbKqCJfiCxwd+SJkKsceNJBZm6g3yBjf3hi8DB/pIIbUk0fhwGZYTo7+YItxZQY4haMetXPClzm93QRg1Cx8134a2Q== <span class="number">11</span>yj3312@gmail.<span class="keyword">com</span></span><br><span class="line"></span><br><span class="line"># 在SSH <span class="built_in">and</span> GPG <span class="built_in">keys</span> 中点击New SSH key，title可以随便命名，将上面的内容复制到其中</span><br></pre></td></tr></table></figure><p>通过上面的步骤，项目已经推送大GitHub的master分支下面了，接下来我们对hexo进行一些配置：<br>在hexo的根目录下面，用vim打开——config.yml文件：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># Deployment</span></span><br><span class="line"><span class="meta">## Docs: https:<span class="comment">//hexo.io/docs/deployment.html</span></span></span><br><span class="line"><span class="symbol">deploy:</span></span><br><span class="line"><span class="symbol">  type:</span> git <span class="meta">#部署方式</span></span><br><span class="line"><span class="symbol">  repository:</span> git@github.com:jingyu9603/yujing_blog.git <span class="meta">#关联github仓库</span></span><br><span class="line"><span class="symbol">  branch:</span> run-page <span class="meta">#部署分支</span></span><br></pre></td></tr></table></figure><p>在这里部署的分支用于后面更新博客使用<br>在配置好以后，我们再执行下面的操作：</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hexo clean #清理各种缓存和旧文件</span><br><span class="line">hexo g #生成静态文件</span><br><span class="line">hexo d # 将public目录同步到GitHub</span><br><span class="line"></span><br><span class="line">## 在进行部署时可能会遇到下面的错误</span><br><span class="line"><span class="keyword">ERROR </span>Deployer not found: gi</span><br><span class="line">## 这是由于我们缺少了一个依赖，安装如下:</span><br><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p>再执行一下<code>hexo d</code>操作，我们会发现在我们github项目中多了一个<code>run-page</code>的分支</p><h5 id="发布网站"><a href="#发布网站" class="headerlink" title="发布网站"></a>发布网站</h5><ul><li>注册一个Netlify账号，Netlify提供邮箱注册和包括GitHub、GitLab和Bitbucket在内的第三方验证登陆，在这里以GitHub为例</li><li>注册好以后，进入页面，点击‘New sit from Git’</li><li>点击GitHub，关联Netlify和github的仓库，首次关联时点击Authorize netlify同意授权后，Netlify可以有权访问你在GitHub上的仓库内容了，授权完成以后，就可以选择之前建立的hexo_netlify仓库</li><li>选择run-page分支，在Basic build setting 选项中，两个条目清空，最后点击Deploysit。Netlify就可以构建并发布网站内容了</li><li>构建完成以后，Netlify会在网站发布成功的同时提供给你一个*.netlify.com为后缀以及随机生成的英文名为前缀的子域名。假如你不喜欢Netlify给你的前缀，点击Site settings,在里面可以修改。</li></ul><h4 id="博客优化"><a href="#博客优化" class="headerlink" title="博客优化"></a>博客优化</h4><h5 id="安装主题"><a href="#安装主题" class="headerlink" title="安装主题"></a>安装主题</h5><p>在<a href="https://www.zhihu.com/question/24422335" target="_blank" rel="noopener">网页上</a>寻找自己喜欢的主题，主题的安装过程很简单，以next主题为例子，在官网有安装步骤：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir themes/<span class="keyword">next</span> </span><br><span class="line">curl -s <span class="symbol">https:</span>/<span class="regexp">/api.github.com/repos</span><span class="regexp">/iissnan/hexo</span>-theme-<span class="keyword">next</span>/releases/latest <span class="params">| grep tarball_url |</span> cut -d <span class="string">'"'</span> -f <span class="number">4</span> <span class="params">| wget -i - -O- |</span> tar -zx -C themes/<span class="keyword">next</span> --strip-components=<span class="number">1</span></span><br></pre></td></tr></table></figure><h5 id="启用主题"><a href="#启用主题" class="headerlink" title="启用主题"></a>启用主题</h5><p>修改站点的配置文件<code>_config.yml</code></p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Extensions</span><br><span class="line">## Plugins: https:<span class="comment">//hexo.io/plugins/</span></span><br><span class="line">## Themes: https:<span class="comment">//hexo.io/themes/</span></span><br><span class="line">theme: next</span><br></pre></td></tr></table></figure><p><code>next</code>主题下面还分了四种不同的主题：</p><ul><li>Muse - 默认 Scheme，这是 NexT 最初的版本，黑白主调，大量留白</li><li>Mist - Muse 的紧凑版本，整洁有序的单栏外观</li><li>Pisces - 双栏 Scheme，小家碧玉似的清新</li><li>Gemini - 左侧网站信息及目录，块+片段结构布局</li></ul><p>在主题配置文件，搜索 scheme 关键字。 你会看到有四行 scheme 的配置，将你需用启用的 scheme 前面注释 # 去除就可以了</p><h5 id="使用Valine插件使得Hexo博客具有评论功能"><a href="#使用Valine插件使得Hexo博客具有评论功能" class="headerlink" title="使用Valine插件使得Hexo博客具有评论功能"></a>使用Valine插件使得Hexo博客具有评论功能</h5><p>可参见<a href="http://smartsi.club/add-a-comment-function-to-the-next-theme-of-hexo.html" target="_blank" rel="noopener">SmartSi的blog</a></p><h6 id="获取appid和appkey"><a href="#获取appid和appkey" class="headerlink" title="获取appid和appkey"></a>获取appid和appkey</h6><ul><li>请先登录或注册 <a href="https://leancloud.cn/dashboard/login.html#/signup" target="_blank" rel="noopener">LeanCloud</a>, 进入控制台后点击左下角创建应用，选择免费的开发版即可。注意右上角有几个节点，可以就近选择。</li><li>应用创建好以后，进入刚刚创建的应用，选择左下角的设置&gt;应用Key，然后就能看到你的appid和appkey了：</li></ul><h6 id="Hexo中的开启和设置"><a href="#Hexo中的开启和设置" class="headerlink" title="Hexo中的开启和设置"></a>Hexo中的开启和设置</h6><ul><li>在配置文件中修改代码<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Valine</span></span><br><span class="line"><span class="attr">valine:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  appid:</span>       <span class="comment">## 之前获得的id</span></span><br><span class="line"><span class="attr">  appkey:</span>      <span class="comment">## 之前获得key</span></span><br><span class="line"><span class="attr">  notify:</span> <span class="literal">false</span> <span class="comment">#新的留言是否需要通知</span></span><br><span class="line"><span class="attr">  verify:</span> <span class="literal">false</span> <span class="comment">#留言是否需要验证</span></span><br><span class="line"><span class="attr">  placeholder:</span> <span class="string">欢迎留言！在这里说出你的想法！</span></span><br><span class="line"><span class="attr">  avater:</span> <span class="string">mm</span></span><br><span class="line"><span class="attr">  guest_info:</span> <span class="string">nick,mail</span></span><br><span class="line"><span class="attr">  pageSize:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure></li></ul><h5 id="添加搜索功能"><a href="#添加搜索功能" class="headerlink" title="添加搜索功能"></a>添加搜索功能</h5><ul><li><p>安装hexo-generator-searchdb 插件</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> hexo-generator-searchdb <span class="comment">--save</span></span><br></pre></td></tr></table></figure></li><li><p>打开 站点配置文件 找到Extensions在下面添加</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 搜索</span></span><br><span class="line"><span class="symbol">search:</span></span><br><span class="line"><span class="symbol">  path:</span> search.xml</span><br><span class="line"><span class="symbol">  field:</span> post</span><br><span class="line"><span class="symbol">  format:</span> html</span><br><span class="line"><span class="symbol">  limit:</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure></li><li><p>打开 主题配置文件 找到Local search，将enable设置为true</p></li></ul><h5 id="添加阅读全文按钮"><a href="#添加阅读全文按钮" class="headerlink" title="添加阅读全文按钮"></a>添加阅读全文按钮</h5><p>如果只想要显示文章的部分内容，只需要在文章的合适位置添加：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--more--&gt;</span></span><br></pre></td></tr></table></figure><h5 id="设置网站缩略图标"><a href="#设置网站缩略图标" class="headerlink" title="设置网站缩略图标"></a>设置网站缩略图标</h5><p>我的设置方法是这样的：把你的图片（png或jpg格式，不是favicon.ico）放在themes/next/source/images里，然后打开 主题配置文件 找到favicon，将small、medium、apple_touch_icon三个字段的值都设置成/images/图片名.jpg就可以了，其他字段都注释掉。</p><h5 id="头像设置"><a href="#头像设置" class="headerlink" title="头像设置"></a>头像设置</h5><p>打开 主题配置文件 找到Sidebar Avatar字段</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># Sidebar Avatar</span></span><br><span class="line"><span class="symbol">avatar:</span> <span class="meta-keyword">/images/</span>header.jpg</span><br></pre></td></tr></table></figure><h5 id="设置代码高亮"><a href="#设置代码高亮" class="headerlink" title="设置代码高亮"></a>设置代码高亮</h5><p>在站点配置文件中，搜索<code>highlight</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">highlight:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  line_number:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  auto_detect:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  tab_replace:</span></span><br></pre></td></tr></table></figure><p>文字自动检测默认不启动，所以改成true使其起作用。<br>再到主题配置文件中：<br>找到<code>highlight_theme: normal</code>，注释显示有五种显示主题可用，分别是：</p><ul><li>normal</li><li>night</li><li>night eighties</li><li>night blue</li><li>night bright<br>选择什么要看个人审美了。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R中GEO数据的预处理</title>
      <link href="/2019/06/05/R%E4%B8%ADGEO%E6%95%B0%E6%8D%AE%E7%9A%84%E9%A2%84%E5%A4%84%E7%90%86/"/>
      <url>/2019/06/05/R%E4%B8%ADGEO%E6%95%B0%E6%8D%AE%E7%9A%84%E9%A2%84%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>获得芯片探针与gene的对应关系的三种方法：  </p><ul><li><p>在基因芯片的厂商的官网直接下载</p></li><li><p>从NCBI里面下载文件来解析</p></li><li><p>直接使用Bioconductor包  </p><a id="more"></a><p>以下是直接使用Biocondutor包的流程：</p></li><li><p>获取平台与Bioconductor包之间的对应关系</p></li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">library</span><span class="params">(BiocManager)</span></span></span><br><span class="line">BiocManager::install(<span class="string">"GEOmetadb"</span>)</span><br><span class="line">install.packages(<span class="string">"RSQLite"</span>)</span><br><span class="line">devtools::install_github(<span class="string">"ggrothendieck/sqldf"</span>)</span><br><span class="line"><span class="function"><span class="title">library</span><span class="params">(GEOmetadb)</span></span></span><br><span class="line"><span class="function"><span class="title">library</span><span class="params">(RSQLite)</span></span></span><br><span class="line"><span class="function"><span class="title">library</span><span class="params">(sqldf)</span></span></span><br><span class="line"><span class="function"><span class="title">getSQLiteFile</span><span class="params">()</span></span></span><br><span class="line">con&lt;-dbConnect(RSQLite::SQLite(),<span class="string">"GEOmetadb.sqlite"</span>)</span><br><span class="line">gplToBioc&lt;-dbGetQuery(con,<span class="string">'select gpl,bioc_package,title from gpl where bioc_package is not null'</span>)</span><br></pre></td></tr></table></figure><ul><li><p>下载所需要的包</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> 1:nrow(gplToBioc))&#123;</span><br><span class="line">  <span class="attribute">platform</span>=gplToBioc[i,1]</span><br><span class="line">  <span class="attribute">platformDB</span>=paste(platform,".db",sep = <span class="string">""</span>)</span><br><span class="line">  <span class="keyword">if</span>(platformDB %<span class="keyword">in</span>% rownames(installed.packages()) ==<span class="literal">FALSE</span>)&#123;</span><br><span class="line">    BiocManager::install(platformDB)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>批量获得芯片探针与gene的对应关系</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">library</span>(hgu133a.db)</span><br><span class="line"><span class="title">library</span>(<span class="type">GEOquery</span>)</span><br><span class="line"><span class="meta">#下载GEO数据集</span></span><br><span class="line"><span class="type">GEO</span>&lt;-<span class="string">"GSE24673"</span></span><br><span class="line"><span class="title">if</span>(!file.exists(<span class="type">GEO</span>))&#123;</span><br><span class="line">  gset&lt;-getGEO(<span class="type">GEO</span>,destdir = <span class="string">"."</span>,getGPL = <span class="type">F</span>,<span class="type">AnnotGPL</span> = <span class="type">F</span>)</span><br><span class="line">  save(gset,file=<span class="type">GEO</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">data</span>&lt;-gset[[1]]</span></span><br><span class="line"><span class="class"><span class="keyword">data</span>&lt;-exprs(<span class="title">data</span>)</span></span><br><span class="line"><span class="title">ids</span>&lt;-toTable(hgu133aSYMBOL)</span><br><span class="line"><span class="class"><span class="keyword">data</span>&lt;-<span class="keyword">data</span>[ids$probe_id,]</span></span><br><span class="line"><span class="title">ids</span>$median&lt;-apply(<span class="class"><span class="keyword">data</span>,1,median)</span></span><br><span class="line"><span class="title">ids</span>&lt;-ids[order(ids$symbol,ids$median,decreasing = <span class="type">T</span>),]</span><br><span class="line"><span class="title">ids</span>&lt;-ids[!duplicated(ids$symbol),]</span><br><span class="line"><span class="class"><span class="keyword">data</span>&lt;-<span class="keyword">data</span>[ids$probe_id,]</span></span><br><span class="line"><span class="title">rownames</span>(<span class="class"><span class="keyword">data</span>)&lt;-ids$symbol</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GEO </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Whole-exome analysis</title>
      <link href="/2019/06/05/Whole-exome_analysis/"/>
      <url>/2019/06/05/Whole-exome_analysis/</url>
      
        <content type="html"><![CDATA[<h5 id="软件准备"><a href="#软件准备" class="headerlink" title="软件准备"></a>软件准备</h5><p>在相关软件官网下载最新版本的软件  </p><ul><li>bwa-0.7.17.tar.bz2   </li><li>gatk-4.1.2.0.zip  </li><li>picard-2.20.0-0.tar.bz2   </li><li>samtools-1.9.tar.bz2 <a id="more"></a><h5 id="原始数据质量控制"><a href="#原始数据质量控制" class="headerlink" title="原始数据质量控制"></a>原始数据质量控制</h5>分析数据质量的几个方面：  </li><li>read各个位置的碱基质量分布</li><li>碱基的总体质量分布</li><li>read各个位置上碱基分布比例看，目的是为了分析碱基的分离程度</li><li>GC含量分布</li><li>read各个位置的N含量</li><li>read是否还包含测序的接头序列</li><li>read重复率，这个是实验的扩增所引入的  </li></ul><p><strong>需要的软件</strong></p><ul><li>FastQC，一个java程序，可以很好的帮助我们理解测序数据的质量情况，唯一不足的就是图太丑了</li><li>MultiQC,一个基于Python的小工具，能够将测序数据的多个QC结果整合成一个HTLM网页交互式报告，同时也能导出pdf</li><li>Trimmomatic（cutadapt、sickle、seqtk）等可用于切除接头序列和read的低质量序列</li></ul><h5 id="全外显子组分析（WES）"><a href="#全外显子组分析（WES）" class="headerlink" title="全外显子组分析（WES）"></a>全外显子组分析（WES）</h5><p>需要的工具：  </p><ul><li>bwa</li><li>samtools</li><li>bgzip</li><li>GATK 4.0</li><li>GATK 3.x</li><li>Picard</li></ul><h6 id="数据预处理"><a href="#数据预处理" class="headerlink" title="数据预处理"></a>数据预处理</h6><p><strong>序列比对</strong></p><ul><li><p>为参考基因组构建索引</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bwa </span>index hg38.fa</span><br></pre></td></tr></table></figure></li><li><p>将read比对到参考基因组</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bwa mem -t <span class="number">4</span> -R <span class="string">'@RG\tID:foo_lane\tPL:illumina\tLB:library\tSM:sample_name'</span> /path/to/human<span class="selector-class">.fasta</span> read_1<span class="selector-class">.fq</span><span class="selector-class">.gz</span> read_2<span class="selector-class">.fq</span><span class="selector-class">.gz</span> &gt; sample_name.sam</span><br></pre></td></tr></table></figure></li></ul><p>-t，线程数，我们在这里使用4个线程  ；<br>-R 接的是Read Group的字符串信息，这是一个非常重要的信息，以@RG开头，它是用来将比对的read进行分组的。这个信息对于我们后续对比对数据进行错误率分析和Mark duplicate时非常重要。在Read Group中，有如下几个信息非常重要：  </p><ul><li>1）ID，这是Read Group的分组ID，一般设置为测序的lane ID（不同lane之间的测序过程认为是独立的），下机数据中我们都能看到这个信息的，一般都是包含在fastq的文件名中；</li><li>2）PL，指的是所用的测序平台，这个信息不要随便写！特别是当我们需要使用GATK进行后续分析的时候，更是如此！这是一个很多新手都容易忽视的一个地方，在GATK中，PL只允许被设置为：ILLUMINA,SLX,SOLEXA,SOLID,454,LS454,COMPLETE,PACBIO,IONTORRENT,CAPILLARY,HELICOS或UNKNOWN这几个信息。</li><li>3）SM，样本ID，同样非常重要，有时候我们测序的数据比较多的时候，那么可能会分成多个不同的lane分布测出来，这个时候SM名字就是可以用于区分这些样本；</li><li>4）LB，测序文库的名字，这个重要性稍微低一些，主要也是为了协助区分不同的group而存在。文库名字一般可以在下机的fq文件名中找到，如果上面的lane ID足够用于区分的话，也可以不用设置LB。  </li></ul><p>为了方便后续的分析，一般在输出文件时，将其转换为bam文件</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bwa mem -t 4 -R '@RG<span class="symbol">\t</span>ID:foo_lane<span class="symbol">\t</span>PL:illumina<span class="symbol">\t</span>LB:library<span class="symbol">\t</span>SM:sample_name' /path/to/human.fasta read_1.fq.gz read_2.fq.gz | samtools view -S -b - &gt; sample_name.bam</span><br></pre></td></tr></table></figure><p><strong>排序（sort）</strong><br>第一步的比对是按照FASTQ文件的顺序把read逐一定位到参考基因组上之后，随即就输出了，它不会也不可能在这一步里面能够自动识别比对位置的先后位置重排比对结果。因此，比对后得到的结果文件中，每一条记录之间位置的先后顺序是乱的，我们后续去重复等步骤都需要在比对记录按照顺序从小到大排序下来才能进行，所以这才是需要进行排序的原因。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">time</span> samtools sort -@ <span class="number">4</span> -m <span class="number">4</span>G -O bam -o sample_name<span class="selector-class">.sorted</span><span class="selector-class">.bam</span> sample_name.bam</span><br></pre></td></tr></table></figure><p>-@，用于设定排序时的线程数，我们设为4；<br>-m，限制排序时最大的内存消耗，这里设为4GB；<br>-O 指定输出为bam格式；<br>-o 是输出文件的名字，</p><p><strong>标记重复序列（删除重复序列）</strong><br>我们使用Picard来完成这个事情</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">##标记重复序列</span><br><span class="line">java -jar picard<span class="selector-class">.jar</span> MarkDuplicates \ </span><br><span class="line">  I=sample_name<span class="selector-class">.sorted</span><span class="selector-class">.bam</span> \</span><br><span class="line">  O=sample_name<span class="selector-class">.sorted</span><span class="selector-class">.markdup</span><span class="selector-class">.bam</span> \</span><br><span class="line">  M=sample_name<span class="selector-class">.markdup_metrics</span><span class="selector-class">.txt</span></span><br></pre></td></tr></table></figure><p>这里只把重复序列在输出的新结果中标记出来，但不删除。如果我们非要把这些序列完全删除的话可以这样做：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java -jar picard<span class="selector-class">.jar</span> MarkDuplicates \ </span><br><span class="line">  REMOVE_DUPLICATES=true \</span><br><span class="line">  I=sample_name<span class="selector-class">.sorted</span><span class="selector-class">.bam</span> \</span><br><span class="line">  O=sample_name<span class="selector-class">.sorted</span><span class="selector-class">.markdup</span><span class="selector-class">.bam</span> \</span><br><span class="line">  M=sample_name<span class="selector-class">.markdup_metrics</span><span class="selector-class">.txt</span></span><br></pre></td></tr></table></figure><p>在后面的分析中，在<code>Somatic SNVs+Indels</code>的过程中使用标记的bam的文件，并且使用GATK4.0的主流pipline；在<code>Detect MSI（微卫星不稳定性）</code>的过程中使用GATK3.x的过程</p><h6 id="Somatic-SNVs-Indels"><a href="#Somatic-SNVs-Indels" class="headerlink" title="Somatic SNVs+Indels"></a>Somatic SNVs+Indels</h6><p><strong>重新矫正碱基质量值（BQSR）</strong><br>分为两步:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> gatk BaseRecalibrator \</span><br><span class="line">   -I my_reads.bam \</span><br><span class="line">   -R reference.fasta \</span><br><span class="line">   --known-sites sites_of_variation.vcf \</span><br><span class="line">   --known-sites another/optional/setOfSitesToMask.vcf \</span><br><span class="line">   -O recal_data.table</span><br><span class="line">## 用到的已知变异位点</span><br><span class="line">common_all_20180418_dbsnp_151_hg38.vcf</span><br><span class="line">Homo_sapiens_assembly38.known_indels.vcf</span><br><span class="line">Mills_and_1000G_gold_standard.indels.hg38.vcf</span><br><span class="line">下载地址（GATK的bundle以及1000genomic官网）：ftp://ftp.broadinstitute.org/bundle/hg38/</span><br><span class="line">https://ftp.ncbi.nlm.nih.gov/snp/organisms/</span><br></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gatk ApplyBQSR \</span><br><span class="line">  -R reference<span class="selector-class">.fasta</span> \</span><br><span class="line">  -I <span class="selector-tag">input</span><span class="selector-class">.bam</span> \</span><br><span class="line">  --bqsr-recal-file recalibration<span class="selector-class">.table</span> \</span><br><span class="line">  -O output.bam</span><br></pre></td></tr></table></figure><p><strong>查看测序深度</strong></p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">samtools depth  bamfile  |  awk '&#123;<span class="keyword">sum</span>+=<span class="variable">$3&#125;</span> END &#123; <span class="keyword">print</span> <span class="string">"Average = "</span><span class="keyword">sum</span>/NR&#125;'</span><br></pre></td></tr></table></figure><p><strong>使用qualimap来查看比对好的bam文件的质量</strong><br>在<a href="http://qualimap.bioinfo.cipf.es/" target="_blank" rel="noopener">官网</a>下载使用qualimap</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https://bitbucket.org/kokonech/qualimap/downloads/qualimap_v<span class="meta">.2</span><span class="meta">.12</span>.zip</span><br><span class="line">unzip qualimap_v<span class="meta">.2</span><span class="meta">.12</span>.zip</span><br><span class="line">cd qualimap_v<span class="meta">.2</span><span class="meta">.12</span></span><br><span class="line">./qualimap -h</span><br><span class="line"># 使用qualimap时 一般需要添加内存参数,对于外显子数据，需要添加关于外显子区域的bed文件</span><br><span class="line">qualimap --java-mem-size=8G bamqc -bam <span class="keyword">in</span>.bam -gff exome.bed</span><br></pre></td></tr></table></figure><h6 id="使用旧版的mutects来call-somatic-mutation（现在GATK网站已经不推荐了）"><a href="#使用旧版的mutects来call-somatic-mutation（现在GATK网站已经不推荐了）" class="headerlink" title="使用旧版的mutects来call somatic mutation（现在GATK网站已经不推荐了）"></a>使用旧版的mutects来call somatic mutation（现在GATK网站已经不推荐了）</h6><p>** CreateSomaticPanelOfNormals **panel of normals (PoN) containing germline and artifactual sites for use with Mutect2.  </p><p>Step 1. Run Mutect2 in tumor-only mode for each normal sample.</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~/biosoft/GATK4.0/gatk-4.0.5.1/gatk Mutect2 \</span><br><span class="line">-<span class="ruby">R ~<span class="regexp">/reference/genome</span><span class="regexp">/gatk_hg38/</span>Homo_sapiens_assembly38.fasta \</span></span><br><span class="line"><span class="ruby">-I HG0019<span class="number">0</span>.bam \</span></span><br><span class="line"><span class="ruby">-tumor HG0019<span class="number">0</span> \</span></span><br><span class="line"><span class="ruby">--disable-read-filter MateOnSameContigOrNoMappedMateReadFilter \</span></span><br><span class="line"><span class="ruby">-L interval_list \</span></span><br><span class="line"><span class="ruby">--max-map-distance <span class="number">0</span> \ <span class="comment">## 防止在产生的vcf文件中出现MNPS现象</span></span></span><br><span class="line"><span class="ruby">-O <span class="number">3_</span>HG0019<span class="number">0</span>.vcf.gz</span></span><br></pre></td></tr></table></figure><p>其中的interval_list来自于安捷伦公司的官网，使用的具体bed文件为：S07604514_Padded.bed<br>或者是可以通过CCDS文件自己制作interval_list   </p><ul><li><p>首先在CCDS官网（<a href="ftp://ftp.ncbi.nlm.nih.gov/pub/CCDS/current_human）下载文件" target="_blank" rel="noopener">ftp://ftp.ncbi.nlm.nih.gov/pub/CCDS/current_human）下载文件</a></p></li><li><p>将txt文件转换为bed形式</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">cat</span> CCDS.<span class="number">20160908</span>.txt |grep -w -v Withdrawn|perl -alne <span class="string">'&#123;/\[(.*?)\]/;next unless <span class="variable">$1</span>;<span class="variable">$gene</span>=<span class="variable">$F</span>[2];<span class="variable">$exons</span>=<span class="variable">$1</span>;<span class="variable">$exons</span>=~s/\s//g;<span class="variable">$exons</span>=~s/-/\t/g;print "<span class="variable">$F</span>[0]\t<span class="variable">$_</span>\t<span class="variable">$gene</span>" foreach split/,/,<span class="variable">$exons</span>;&#125;'</span>|sort -u |bedtools sort -i &gt;exon_probe.hg38.gene.bed</span><br></pre></td></tr></table></figure></li><li><p>制作interval_list</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat exon_probe.hg38.gene.bed | awk '&#123;print <span class="string">"chr"</span>$0&#125;' &gt;hg38.chr.bed</span><br><span class="line"></span><br><span class="line">picard BedToIntervalList \</span><br><span class="line">       I=hg38.chr.bed \</span><br><span class="line">       O=hg38.interval_list\</span><br><span class="line">       SD=<span class="string">/data/reference/GRCh38/GRCh38.primary_assembly.genome.dict</span></span><br><span class="line">       </span><br><span class="line">gatk4 PreprocessIntervals </span><br><span class="line">      -L hg38.interval_list  </span><br><span class="line">      <span class="params">--sequence-dictionary</span> <span class="string">/data/reference/GRCh38/GRCh38.primary_assembly.genome.dict</span> </span><br><span class="line">      <span class="params">--reference</span> <span class="string">/data/reference/GRCh38/GRCh38.primary_assembly.genome.fa</span> </span><br><span class="line">      <span class="params">--padding</span> 100 </span><br><span class="line">      <span class="params">--bin-length</span> 0 </span><br><span class="line">      <span class="params">--interval-merging-rule</span> OVERLAPPING_ONLY</span><br><span class="line">      <span class="params">--output</span> hg38.Padded.interval_list</span><br></pre></td></tr></table></figure></li></ul><p>Step 2. Create a GenomicsDB from the normal Mutect2 calls.<br>由于在第一步产生的vcf文件中有多行对应一个位点，所以在进行Step2之前要先将这些同一位点的行合并起来</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bcftools norm <span class="string">\</span></span><br><span class="line">    -m +any --<span class="keyword">do</span>-<span class="keyword">not</span>-normalize <span class="string">\</span></span><br><span class="line">    delta_af-only-gnomad_Hg19toGRCh38.vcf.gz <span class="string">\</span></span><br><span class="line">    -Oz -o zeta_af-only-gnomad_Hg19toGRCh38.vcf.gz</span><br><span class="line"><span class="comment">## 为norm之后的新vcf文件创建索引</span></span><br><span class="line">gatk IndexFeatureFile <span class="string">\</span></span><br><span class="line">     -F cohort.vcf.gz</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## step.2</span></span><br><span class="line"> gatk GenomicsDBImport -R reference.fasta -L intervals.interval_list \</span><br><span class="line">       --genomicsdb-workspace-path pon_db \</span><br><span class="line">       -V normal1.vcf.gz \</span><br><span class="line">       -V normal2.vcf.gz \</span><br><span class="line">       -V normal3.vcf.gz</span><br></pre></td></tr></table></figure><p>Step 3. Combine the normal calls using CreateSomaticPanelOfNormals.</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk CreateSomaticPanelOfNormals -R reference<span class="selector-class">.fasta</span> -V gendb:<span class="comment">//pon_db -O pon.vcf.gz</span></span><br></pre></td></tr></table></figure><p>** 对tumor和matched normal进行calls somatic variants **</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> sample <span class="keyword">in</span> <span class="number">*C</span>*.bam;  </span><br><span class="line"><span class="keyword">do</span> <span class="attribute">base</span>=<span class="variable">$&#123;sample%-*&#125;</span>;  </span><br><span class="line">   gatk4 Mutect2   </span><br><span class="line">   -R /data/reference/GRCh38/GRCh38.primary_assembly.genome.fa   </span><br><span class="line">   -I <span class="string">"<span class="variable">$base</span>"</span>-N.sorted.markdup.recal.bam  </span><br><span class="line">   -I <span class="variable">$sample</span>   </span><br><span class="line">   -tumor <span class="string">"<span class="variable">$base</span>"</span>-C   </span><br><span class="line">   -normal <span class="string">"<span class="variable">$base</span>"</span>-N   </span><br><span class="line">   -pon ./Mutect2_interval/pon.vcf.gz  </span><br><span class="line">   --germline-resource <span class="built_in">..</span>/<span class="built_in">..</span>/reference/somatic-hg38_af-only-gnomad.hg38.vcf.gz  </span><br><span class="line">   --af-of-alleles-not-in-resource 0.0000025  </span><br><span class="line">   -disable-read-filter MateOnSameContigOrNoMappedMateReadFilter  </span><br><span class="line">   -L <span class="built_in">..</span>/<span class="built_in">..</span>/reference/S07604514_hs_hg38/S07604514_hs_hg38/S07604514_Padded.bed   </span><br><span class="line">   -O ./Mutect2_interval/Mutect2_output/<span class="string">"<span class="variable">$base</span>"</span>_somatic_m2.vcf.gz   </span><br><span class="line">   -bamout ./Mutect2_interval/Mutect2_output/<span class="string">"<span class="variable">$base</span>"</span>_tumor_normal_m2.bam;done</span><br></pre></td></tr></table></figure><p>** 使用<code>GetPileupSummaries</code>工具来计算肿瘤样本的污染情况 ** 先使用Selectvariants工具生成包含commom biallelic variants的.vcf文件</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">gatk SelectVariants \</span><br><span class="line">-R ~/reference/genome/gatk_hg38/Homo_sapiens_assembly38.fasta \</span><br><span class="line">-V af-only-gnomad.hg38.vcf.gz \</span><br><span class="line">--select-type-to-include SNP \</span><br><span class="line">--restrict-alleles-to BIALLELIC \</span><br><span class="line">-O af-only-gnomad.hg38.SNP_biallelic.vcf.gz</span><br></pre></td></tr></table></figure><p>接着用GetPileupSummaries计算resource site位点上的count数，这样并不是计算所有的位点，而是用AF参数过滤后的（大于0.01并小于0.2），同时也可以用 -L 参数指定区域，分别对Normal和Tumor样本计算</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~/biosoft/GATK4.<span class="number">0</span>/gatk-<span class="number">4.0</span>.<span class="number">5.1</span>/gatk GetPileupSummaries \</span><br><span class="line">-I Normal_blood<span class="selector-class">.allready</span><span class="selector-class">.bam</span> \</span><br><span class="line">-L ../exon_150bp<span class="selector-class">.list</span> \</span><br><span class="line">-V ~/annotation/GATK/resources/bundle/hg38/af-only-gnomad<span class="selector-class">.hg38</span><span class="selector-class">.SNP_biallelic</span><span class="selector-class">.vcf</span><span class="selector-class">.gz</span> \</span><br><span class="line">-O Normal_blood<span class="selector-class">.pileups</span><span class="selector-class">.table</span></span><br></pre></td></tr></table></figure><p>总之最后通过计算出的污染比例（XXX.calculatecontamination.table文件中）来过滤掉somatic variant中的一些可能是污染导致的假阳性突变</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gatk CalculateContamination \</span><br><span class="line">-I Primary-IIIG<span class="selector-class">.pileups</span><span class="selector-class">.table</span> \</span><br><span class="line">-matched Normal_blood<span class="selector-class">.pileups</span><span class="selector-class">.table</span> \</span><br><span class="line">-O Primary-IIIG<span class="selector-class">.calculatecontamination</span><span class="selector-class">.table</span></span><br></pre></td></tr></table></figure><h6 id="使用Muect2新流程进行calling-somatic-mutation"><a href="#使用Muect2新流程进行calling-somatic-mutation" class="headerlink" title="使用Muect2新流程进行calling somatic mutation"></a>使用Muect2新流程进行calling somatic mutation</h6><p>首先需要创建PON，步骤与旧版的相同，接下买的操作如下</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## First, run Mutect2 with the --f1r2-tar-gz argument. This creates an output with raw data</span></span><br><span class="line"><span class="keyword">if</span> [ 1 -eq 1 ];</span><br><span class="line">then</span><br><span class="line"><span class="attribute">workdir</span>=/media/data1/YJ/CRC/tag_duplicates/tag-dup_rec/;</span><br><span class="line"><span class="attribute">outdir</span>=/media/data1/YJ/CRC/tag_duplicates/tag-dup_rec/Mutect2_interval/Mutect2_new_withnewPON_matchedmodel/;</span><br><span class="line"><span class="attribute">refdir</span>=/media/data1/YJ/CRC/reference/;</span><br><span class="line">cd <span class="variable">$workdir</span>;</span><br><span class="line"><span class="keyword">for</span> sample <span class="keyword">in</span> <span class="number">*C</span>*.bam;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="attribute">base</span>=<span class="variable">$&#123;sample%%-*&#125;</span>;</span><br><span class="line">gatk4 Mutect2 -R /data/reference/GRCh38/GRCh38.primary_assembly.genome.fa \</span><br><span class="line">-L /media/data1/YJ/CRC/reference/S07604514_hs_hg38/S07604514_hs_hg38/S07604514_Padded.bed \</span><br><span class="line">-I <span class="variable">$sample</span> \</span><br><span class="line">-I <span class="string">"<span class="variable">$base</span>"</span>-N.sorted.markdup.recal.bam \</span><br><span class="line">-tumor <span class="string">"<span class="variable">$base</span>"</span>-C \</span><br><span class="line">-normal <span class="string">"<span class="variable">$base</span>"</span>-N \</span><br><span class="line">-germline-resource <span class="string">"<span class="variable">$refdir</span>"</span>somatic-hg38_af-only-gnomad.hg38.vcf.gz \</span><br><span class="line">-pon <span class="string">"<span class="variable">$workdir</span>"</span>Mutect2_interval/pon_withgnomAD.vcf.gz \</span><br><span class="line">--f1r2-tar-gz <span class="string">"<span class="variable">$outdir</span>"</span><span class="string">"<span class="variable">$base</span>"</span>.f1r2.tar.gz \</span><br><span class="line">-O <span class="string">"<span class="variable">$outdir</span>"</span><span class="string">"<span class="variable">$base</span>"</span>.unfiltered.vcf;</span><br><span class="line">done;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="comment">## Next, pass this raw data to LearnReadOrientationModel:</span></span><br><span class="line"><span class="keyword">if</span> [ 1 -eq 1 ] ;</span><br><span class="line">then</span><br><span class="line"><span class="attribute">workdir</span>=/media/data1/YJ/CRC/tag_duplicates/tag-dup_rec/Mutect2_interval/Mutect2_new_withnewPON_matchedmodel;</span><br><span class="line">cd <span class="variable">$workdir</span>;</span><br><span class="line"><span class="keyword">for</span> sample <span class="keyword">in</span> *.tar.gz;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="attribute">base</span>=<span class="variable">$&#123;sample%%.*&#125;</span>;</span><br><span class="line">gatk4 LearnReadOrientationModel -I <span class="variable">$sample</span> -O <span class="string">"<span class="variable">$base</span>"</span>_read-orientation-model.tar.gz;</span><br><span class="line">done;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="comment">## Finally, pass the learned read orientation model to FilterMutectCallswith the -ob-priors argument:</span></span><br><span class="line"><span class="keyword">if</span> [ 1 -eq 1 ];</span><br><span class="line">then</span><br><span class="line"><span class="attribute">workdir</span>=/media/data1/YJ/CRC/tag_duplicates/tag-dup_rec/Mutect2_interval/Mutect2_new_withnewPON_matchedmodel;</span><br><span class="line"><span class="attribute">refdir</span>=/data/reference/GRCh38;</span><br><span class="line">cd <span class="variable">$workdir</span></span><br><span class="line"><span class="keyword">for</span> sample <span class="keyword">in</span> *.unfiltered.vcf;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="attribute">base</span>=<span class="variable">$&#123;sample%%.*&#125;</span>;</span><br><span class="line">gatk4 FilterMutectCalls -V <span class="variable">$sample</span> \</span><br><span class="line">--ob-priors <span class="string">"<span class="variable">$base</span>"</span>_read-orientation-model.tar.gz \</span><br><span class="line">-R <span class="string">"<span class="variable">$refdir</span>"</span>/GRCh38.primary_assembly.genome.fa \</span><br><span class="line">-O <span class="string">"<span class="variable">$base</span>"</span>_filtered.vcf</span><br><span class="line">done;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>最终获得利用<code>FilterMutectCalls</code>过滤过的filtered.vcf文件然后得到通过过滤的vcf文件</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##filter the .filtered.vcf and annotation it with gene_based model</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="number">1</span> -eq <span class="number">1</span> ];</span><br><span class="line">then</span><br><span class="line"><span class="keyword">for</span> sample <span class="keyword">in</span> *_filtered.vcf;</span><br><span class="line">do</span><br><span class="line"></span><br><span class="line">base=$&#123;sample%%_*&#125;;</span><br><span class="line">grep -v <span class="string">"#"</span> $sample | awk <span class="string">'$7=="PASS"'</span> &gt; <span class="string">"$base"</span>_filtered_PASS.cvf;</span><br><span class="line">done;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>可以通过<code>VariantAnnotator</code>对vcf文件进行dbsnp注释</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##Annotation vcf with dbsnp                                                                                                   </span></span><br><span class="line"><span class="keyword">if</span> [ <span class="number">1</span> -eq <span class="number">0</span> ];                                                                                                                </span><br><span class="line">then                                                                                                   </span><br><span class="line">        <span class="keyword">for</span> sample <span class="keyword">in</span> *_filtered.vcf;                                                               </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                base=<span class="variable">$&#123;sample%%_*&#125;</span>;  </span><br><span class="line">                gatk4 VariantAnnotator -R <span class="regexp">/data/</span>reference<span class="regexp">/GRCh38/</span>GRCh38.primary_assembly.genome.fa \ </span><br><span class="line">                        -I ..<span class="regexp">/../</span><span class="string">"$base"</span>-C.sorted.markdup.recal.bam \  </span><br><span class="line">                        -V <span class="variable">$sample</span> \        </span><br><span class="line">                        --output <span class="string">"$base"</span>_filtered_dbsnp.vcf \ </span><br><span class="line">                        -A Coverage \           </span><br><span class="line">                        --dbsnp <span class="regexp">/media/</span>data1<span class="regexp">/YJ/</span>CRC<span class="regexp">/reference/</span>common_all_20180418_dbsnp_151_hg38.vcf ;</span><br><span class="line">        done                   </span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>注释完的vcf文件中多了一列ID的信息，里面有snp号，可以通过<a href="https://www.snpedia.com/index.php/SNPedia" target="_blank" rel="noopener">SNPedia网站</a>查看snp的具体信息</p><h6 id="使用不同的方法进行annotation"><a href="#使用不同的方法进行annotation" class="headerlink" title="使用不同的方法进行annotation"></a>使用不同的方法进行annotation</h6><p><strong>ANNOVAR</strong><br>在ANNOVAR官网下载最新版本的软件</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 下载适合的数据库(下载的数据储存在GRCH38文件夹中)</span></span><br><span class="line"> annotate_variation.pl -downdb -buildver hg19 -webfrom annovar refGene GRCH38/</span><br><span class="line"><span class="comment">## 利用 ANNOVAR进行基于gene的annotation</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="number">1</span> -eq <span class="number">1</span> ];</span><br><span class="line">then</span><br><span class="line">sofadir=/media/data1/YJ/CRC/softwave/annovar;</span><br><span class="line"><span class="keyword">for</span> sample <span class="keyword">in</span> *filtered_PASS.vcf;</span><br><span class="line">do</span><br><span class="line">base=$&#123;sample%%.*&#125;;</span><br><span class="line"></span><br><span class="line">$sofadir/convert2annovar.pl -format vcf4 $sample -outfile <span class="string">"$base"</span>.avinput;</span><br><span class="line">$sofadir/annotate_variation.pl -out <span class="string">"$base"</span> \</span><br><span class="line">-build hg38 \</span><br><span class="line"><span class="string">"$base"</span>.avinput \</span><br><span class="line">--geneanno -dbtype refGene \</span><br><span class="line">$sofadir/GRCH38/</span><br><span class="line">done;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>结果会得到两个文件：</p><ul><li>在外显子位点的注释：s0020487998_filtered_PASS.exonic_variant_function<br><img src="https://note.youdao.com/yws/public/resource/bed499f2133fd1cc1e1ced485447f8c1/xmlnote/WEBRESOURCE22c444411c67fe341deac1f544ccb7ae/6557" alt="image"></li><li>在所有位点的注释：<br>s0020487998_filtered_PASS.variant_function<br><img src="https://note.youdao.com/yws/public/resource/bed499f2133fd1cc1e1ced485447f8c1/xmlnote/WEBRESOURCEe3710742911832dc4bc8e26297d630c7/6567" alt="image"><br>XX.variant_function文件一般关心前两列，后面几列均是变异位点的一些信息<br>第一列是变异所在基因组的位置，如：exonic、splicing、ncRNA等；其优先级：exonic = splicing &gt; ncRNA&gt; &gt; UTR5/UTR3 &gt; intron &gt; upstream/downstream &gt; intergenic<br>第二列信息则给突变位点所在的基因名称（如果突变在exonic/intronic/ncRNA），或者给出临近基因的名称</li></ul><p><strong>ClinEff</strong><br>在ClinEff的<a href="http://www.dnaminer.com/clineff.html" target="_blank" rel="noopener">官网</a>下载最新版本的软件已经相关的database</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">-xvf</span> <span class="selector-tag">clinEff</span><span class="selector-class">.1</span><span class="selector-class">.0h</span><span class="selector-class">.tgz</span></span><br><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">-xvf</span> <span class="selector-tag">clinEff_db38_v1</span><span class="selector-class">.0</span><span class="selector-class">.tgz</span></span><br></pre></td></tr></table></figure><p><strong>SnpEff</strong><br>在<a href="http://snpeff.sourceforge.net/download.html" target="_blank" rel="noopener">SnpEff的官网</a>下载最新版本的软件</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">wget http://sourceforge.net/projects/snpeff/files/snpEff_latest_core.zip</span><br><span class="line">unzip snpEff_latest_core.zip</span><br><span class="line"><span class="comment">#查看homo_sapiens相关的数据库</span></span><br><span class="line">java -jar snpEff.jar databases | grep <span class="string">"Home_sapiens"</span> | cut -f <span class="number">1</span>,<span class="number">2</span></span><br><span class="line"></span><br><span class="line">GRCh37.75       Homo_sapiens</span><br><span class="line">GRCh38.86       Homo_sapiens</span><br><span class="line">hg19            Homo_sapiens (UCSC)</span><br><span class="line">hg19kg          Homo_sapiens (UCSC KnownGenes)</span><br><span class="line">hg38            Homo_sapiens (UCSC)</span><br><span class="line">hg38kg          Homo_sapiens (UCSC KnownGenes)</span><br><span class="line">testHg19ChrM    Homo_sapiens (UCSC)</span><br><span class="line"></span><br><span class="line"><span class="comment">#由于我们之前是使用的GRCh38的基因组，所以我们就下载GRCh38.86</span></span><br><span class="line">java -jar snpEff.jar download GRCh38.86</span><br><span class="line"><span class="comment">#注释</span></span><br><span class="line">java -Xmx4g -jar /media/data1/YJ/CRC/softwave/snpEff/snpEff.jar GRCh38.86 s0020347988_filtered_PASS.vcf &gt; s0020347988_filtered_PASS.snpEff.vcf</span><br></pre></td></tr></table></figure><p>输出的vcf文件，在输入vcf文件的基础上添加了一些tag：ANN、LOF、NMD<br>因此我可以将这个vcf格式文件稍微处理下，保留原来的vcf文件的前5列，再加上ANNtag形成一个新文件来查看</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">for</span> sample in *PASS*;</span><br><span class="line"><span class="attribute">do</span> </span><br><span class="line">    base=<span class="variable">$&#123;sample%%_*&#125;</span>;</span><br><span class="line">    <span class="attribute">perl</span> -alne <span class="string">'next if <span class="variable">$_</span> =~ /^#/;<span class="variable">$F</span>[7] =~ /(ANN=\S+)/;print "<span class="variable">$F</span>[1]\t<span class="variable">$F</span>[2]\t<span class="variable">$F</span>[3]\t<span class="variable">$F</span>[4]\t<span class="variable">$F</span>[5]\t<span class="variable">$1</span>"'</span> <span class="variable">$sample</span> &gt; <span class="string">"<span class="variable">$base</span>"</span>.anntag.vcf</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>vcf文件的内容如下：</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">29275630</span>        .       C       T       .       ANN=T|<span class="type">stop_gained</span>|<span class="type">HIGH</span>|<span class="type">PTPRU</span>|<span class="type">ENSG00000060656</span>|<span class="type">transcript</span>|<span class="type">ENST00000345512</span><span class="number">.7</span>|<span class="type">protein_coding</span>|<span class="type">8</span>/<span class="number">31</span>|<span class="type">c</span><span class="number">.1327</span>C&gt;T|<span class="type">p</span>.Gln443*|<span class="type">1456</span>/<span class="number">4470</span>|<span class="type">1327</span>/<span class="number">4341</span>|<span class="type">443</span>/<span class="number">1446</span>|<span class="type">|, </span></span><br><span class="line"><span class="type">                                                    T</span>|<span class="type">stop_gained</span>|<span class="type">HIGH</span>|<span class="type">PTPRU</span>|<span class="type">ENSG00000060656</span>|<span class="type">transcript</span>|<span class="type">ENST00000373779</span><span class="number">.7</span>|<span class="type">protein_coding</span>|<span class="type">8</span>/<span class="number">30</span>|<span class="type">c</span><span class="number">.1327</span>C&gt;T|<span class="type">p</span>.Gln443*|<span class="type">1456</span>/<span class="number">5579</span>|<span class="type">1327</span>/<span class="number">4311</span>|<span class="type">443</span>/<span class="number">1436</span>|<span class="type">|,</span></span><br><span class="line"><span class="type">                                                    T</span>|<span class="type">stop_gained</span>|<span class="type">HIGH</span>|<span class="type">PTPRU</span>|<span class="type">ENSG00000060656</span>|<span class="type">transcript</span>|<span class="type">ENST00000428026</span><span class="number">.6</span>|<span class="type">protein_coding</span>|<span class="type">8</span>/<span class="number">30</span>|<span class="type">c</span><span class="number">.1327</span>C&gt;T|<span class="type">p</span>.Gln443*|<span class="type">1423</span>/<span class="number">5550</span>|<span class="type">1327</span>/<span class="number">4302</span>|<span class="type">443</span>/<span class="number">1433</span>|<span class="type">|,</span></span><br><span class="line"><span class="type">                                                    T</span>|<span class="type">stop_gained</span>|<span class="type">HIGH</span>|<span class="type">PTPRU</span>|<span class="type">ENSG00000060656</span>|<span class="type">transcript</span>|<span class="type">ENST00000460170</span><span class="number">.2</span>|<span class="type">protein_coding</span>|<span class="type">8</span>/<span class="number">31</span>|<span class="type">c</span><span class="number">.1327</span>C&gt;T|<span class="type">p</span>.Gln443*|<span class="type">1333</span>/<span class="number">5337</span>|<span class="type">1327</span>/<span class="number">4323</span>|<span class="type">443</span>/<span class="number">1440</span>|<span class="type">|,</span></span><br><span class="line"><span class="type">                                                    T</span>|<span class="type">upstream_gene_variant</span>|<span class="type">MODIFIER</span>|<span class="type">PTPRU</span>|<span class="type">ENSG00000060656</span>|<span class="type">transcript</span>|<span class="type">ENST00000415600</span><span class="number">.6</span>|<span class="type">processed_transcript</span>|<span class="type">|n</span>.<span class="number">-3921</span>C&gt;T|<span class="type">||||3921</span>|<span class="type">,</span></span><br><span class="line"><span class="type">                                                    T</span>|<span class="type">non_coding_transcript_exon_variant</span>|<span class="type">MODIFIER</span>|<span class="type">PTPRU</span>|<span class="type">ENSG00000060656</span>|<span class="type">transcript</span>|<span class="type">ENST00000527027</span><span class="number">.1</span>|<span class="type">processed_transcript</span>|<span class="type">3</span>/<span class="number">3</span>|<span class="type">n</span><span class="number">.564</span>C&gt;T|<span class="type">|||||;</span></span><br><span class="line"><span class="type">                                                    LOF</span>=(PTPRU|<span class="type">ENSG00000060656</span>|<span class="type">11</span>|<span class="type">0</span><span class="number">.36</span>);</span><br><span class="line">                                                    NMD=(PTPRU|<span class="type">ENSG00000060656</span>|<span class="type">11</span>|<span class="type">0</span><span class="number">.36</span>)</span><br></pre></td></tr></table></figure><p>往往一个突变条目对应着多个annotation报告，主要有一下几种原因：</p><ul><li>一个突变位点可以影响多个基因，比如一个突变可能是一个基因的DOWNSTREAM同时可能是另一个基因的UPSTREAM</li><li>在复杂的基因组中，一个基因可能对应着多个转录组，snpeff会指出受该突变影响的每一个转录本</li><li>一条vcf记录可能包含不止一种突变<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#CHROM  POS      ID    REF  ALT    QUAL FILTER    INFO</span></span><br><span class="line">1       889455   .     G    A,T    .    .         ANN=A|<span class="string">stop_gained</span>|<span class="string">HIGH</span>|<span class="string">NOC2L</span>|<span class="string">ENSG00000188976</span>|<span class="string">transcript</span>|<span class="string">ENST00000327044</span>|<span class="string">protein_coding</span>|<span class="string">7/19</span>|<span class="string">c.706C&gt;T</span>|<span class="string">p.Gln236*</span>|<span class="string">756/2790</span>|<span class="string">706/2250</span>|<span class="string">236/749</span>||</span><br><span class="line">                                                     ,T|<span class="string">missense_variant</span>|<span class="string">MODERATE</span>|<span class="string">NOC2L</span>|<span class="string">ENSG00000188976</span>|<span class="string">transcript</span>|<span class="string">ENST00000327044</span>|<span class="string">protein_coding</span>|<span class="string">7/19</span>|<span class="string">c.706C&gt;A</span>|<span class="string">p.Gln236Lys</span>|<span class="string">756/2790</span>|<span class="string">706/2250</span>|<span class="string">236/749</span>||</span><br><span class="line">                                                     ,A|<span class="string">downstream_gene_variant</span>|<span class="string">MODIFIER</span>|<span class="string">NOC2L</span>|<span class="string">ENSG00000188976</span>|<span class="string">transcript</span>|<span class="string">ENST00000487214</span>|<span class="string">processed_transcript</span>||<span class="string">n.*865C&gt;T</span>|||||<span class="string">351</span>|</span><br><span class="line">                                                     ,T|<span class="string">downstream_gene_variant</span>|<span class="string">MODIFIER</span>|<span class="string">NOC2L</span>|<span class="string">ENSG00000188976</span>|<span class="string">transcript</span>|<span class="string">ENST00000487214</span>|<span class="string">processed_transcript</span>||<span class="string">n.*865C&gt;A</span>|||||<span class="string">351</span>|</span><br><span class="line">                                                     ,A|<span class="string">downstream_gene_variant</span>|<span class="string">MODIFIER</span>|<span class="string">NOC2L</span>|<span class="string">ENSG00000188976</span>|<span class="string">transcript</span>|<span class="string">ENST00000469563</span>|<span class="string">retained_intron</span>||<span class="string">n.*878C&gt;T</span>|||||<span class="string">4171</span>|</span><br><span class="line">                                                     ,T|<span class="string">downstream_gene_variant</span>|<span class="string">MODIFIER</span>|<span class="string">NOC2L</span>|<span class="string">ENSG00000188976</span>|<span class="string">transcript</span>|<span class="string">ENST00000469563</span>|<span class="string">retained_intron</span>||<span class="string">n.*878C&gt;A</span>|||||<span class="string">4171</span>|</span><br><span class="line">                                                     ,A|<span class="string">non_coding_exon_variant</span>|<span class="string">MODIFIER</span>|<span class="string">NOC2L</span>|<span class="string">ENSG00000188976</span>|<span class="string">transcript</span>|<span class="string">ENST00000477976</span>|<span class="string">retained_intron</span>|<span class="string">5/17</span>|<span class="string">n.2153C&gt;T</span>||||||</span><br><span class="line">                                                     ,T|<span class="string">non_coding_exon_variant</span>|<span class="string">MODIFIER</span>|<span class="string">NOC2L</span>|<span class="string">ENSG00000188976</span>|<span class="string">transcript</span>|<span class="string">ENST00000477976</span>|<span class="string">retained_intron</span>|<span class="string">5/17</span>|<span class="string">n.2153C&gt;A</span>||||||<span class="string">;LOF=(NOC2L</span>|<span class="string">ENSG00000188976</span>|<span class="string">6</span>|<span class="string">0.17);NMD=(NOC2L</span>|<span class="string">ENSG00000188976</span>|<span class="string">6</span>|<span class="string">0.17)</span></span><br></pre></td></tr></table></figure></li></ul><p>当存在多种effect时，effect排序的依据：</p><ul><li>根据Putative impact：具有更高等级的putative impact将会排在前面</li><li>Effect type：有害的effect会排在前面</li><li>Canonical trancript before non-canonical.</li><li>Marker genomic coordinates (e.g. genes starting before first).　　</li></ul><p><code>ANN</code>tag将注释信息以“|”分割，每个filed有其对应的信息：</p><ul><li>Allele（or ALT）：突变的碱基</li><li>Annotation：表示突变的类型，当有多种类型存在时，用@连接，可以在 <a href="http://sequenceontology.org/browser/current_svn/term/SO:0001792" target="_blank" rel="noopener">The Sequence ontology官网</a>查询每一种突变类型的具体含义</li><li>Putative_impact：对突变的影响进行的预测，有4个程度</li></ul><p>1.HIGH：突变对蛋白的影响很大，可能导致蛋白质截短、功能丧失或引发无意义的介导衰退。eg.stop_gained, frameshift_variant<br>2.MODERATE：一种可能改变蛋白质有效性的无破坏性突变  eg.missense_variant, inframe_deletion<br>3.LOW：几乎是没害的，不会改变蛋白质的性能，eg.synonymous_variant<br>4.MODIFIER:通常是影响非编码基因的突变或非编码区的突变，对其很难预测它的影响。eg.exon_variant, downstream_gene_variant</p><ul><li>Gene ID：使用ENSEMBL id</li><li>Feature type：表示突变所在区域的类型，比如transcript, motif, miRNA等</li><li>Feature ID ：表示Feature type对应的id</li><li>Transcript biotype ：关于transcript的类型，根据ENSEMBL biotypes来定义，</li><li>Rank/total：1/1表示Exon or Intron rank / total number of exons or introns，前面的1表示这个突变是在第1个exon上（因为annatation已经给出了这个是突变是在exon上），后面的11表示这个突变所在的transcript总共有1个exon</li><li>HGVS.c ：n.321T&gt;C表示Variant using HGVS notation (DNA level)</li><li>HGVS.p：如果突变发生在ｃｏｄｉｎｇ区域，根据HGVS标记法在蛋白质水平表示突变类型。p.Gln443*表示443位的Gln氨基酸突变成了终止密码子</li><li>cDNA_position/cDNA_len:cDNA的位置以及，cDNA的长度</li><li>CDS_position / CDS_len: Position and number of coding bases (one based includes START and STOP codons).</li><li>Protein_position / Protein_len: Position and number of AA (one based, including START, but not STOP).</li></ul><p>至于LOF和NMD标签这是表示：Loss of funcation(LOF) and nonsense-mediated   decay(NMD) 预测  ，分析相关的effect是否可以产生LOF或者是NMD影响  </p><p>NMD：无义介导的mRNA降解作为真核细胞中重要RNA监控机制，识别并降解开放阅读框中含有提前终止密码子（premature termination codon，PTC）的mRNA，以避免因截短的蛋白产物积累对细胞造成毒害. NMD还调控正常生理基因的表达，暗示其在真核细胞中扮演重要角色.  </p><p> LOF和NMD标签的形式如下：</p><ul><li>Gene：gene的名称</li><li>ID：gene id，通常是ENSEMBL id</li><li>Num_transcripts：gene中的转录本的数量</li><li>percent_affected：被改突变多影响的转录本的比例</li></ul><h6 id="使用VarScan2-Somatic来call-somatic（没有写完）"><a href="#使用VarScan2-Somatic来call-somatic（没有写完）" class="headerlink" title="使用VarScan2 Somatic来call somatic（没有写完）"></a>使用VarScan2 Somatic来call somatic（没有写完）</h6><h6 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h6><p>1 创建文件夹</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -<span class="selector-tag">p</span> <span class="selector-tag">input</span> reference scripts temp</span><br></pre></td></tr></table></figure><p>2 安装conda并使用conda创建env</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加信号源</span></span><br><span class="line">conda config --add channels r</span><br><span class="line">conda config --add channels defaults</span><br><span class="line">conda config --add channels conda-forge</span><br><span class="line">conda config --add channels bioconda</span><br><span class="line"><span class="comment"># 创建env</span></span><br><span class="line">conda create --name altwes gatk R samtools trimmomatic picard bam-readcount</span><br><span class="line">varscan</span><br><span class="line"><span class="comment"># 激活env</span></span><br><span class="line">conda activate altwes</span><br></pre></td></tr></table></figure><p>3 安装GATK3.8</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">WES=/</span><br><span class="line">cd <span class="variable">$WES</span>/scripts</span><br><span class="line">wget -r -np -nd \</span><br><span class="line">-O gatk3<span class="selector-class">.tar</span><span class="selector-class">.bz2</span> \</span><br><span class="line">’https:<span class="comment">//software.broadinstitute.org/gatk/download/auth?package=GATK-archive&amp;version=3.8-0-ge9d806836’</span></span><br><span class="line">bunzip2 gatk3<span class="selector-class">.tar</span><span class="selector-class">.bz2</span></span><br><span class="line">tar -xf gatk3.tar</span><br></pre></td></tr></table></figure><h5 id="Detect-MSI"><a href="#Detect-MSI" class="headerlink" title="Detect MSI"></a>Detect MSI</h5><h6 id="数据预处理-1"><a href="#数据预处理-1" class="headerlink" title="数据预处理"></a>数据预处理</h6><p><strong>局部重比对</strong><br>接下来是局部区域重比对，通常也叫Indel局部区域重比对。有时在进行这一步骤之前还有一个merge的操作，将同个样本的所有比对结果合并成唯一一个大的BAM文件，merge的例子如下：</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">samtools merge &lt;out.bam&gt; &lt;in1.bam&gt; <span class="meta">[&lt;in2.bam&gt;...&lt;inN.bam&gt;]</span></span><br></pre></td></tr></table></figure><p>局部重比对的目的是将BWA比对过程中所发现有潜在序列插入或者序列删除（insertion和deletion，简称Indel）的区域进行重新校正。这个过程往往还会把一些已知的Indel区域一并作为重比对的区域<br>GATK4.0中没有分离出单独的局部比对脚本。只能使用3.X版本中的脚本,这里包含了两个步骤：</p><ul><li>第一步，RealignerTargetCreator ，目的是定位出所有需要进行序列重比对的目标区域</li><li>第二步，IndelRealigner，对所有在第一步中找到的目标区域运用算法进行序列重比对，最后得到捋顺了的新结果。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">java -jar /path/to/GenomeAnalysisTK.jar \</span><br><span class="line"> -T RealignerTargetCreator \</span><br><span class="line"> -R /path/to/human.fasta \</span><br><span class="line"> -I sample_name.sorted.markdup.bam \</span><br><span class="line"> -known /path/to/gatk/bundle/1000G_phase1.indels.b37.vcf \</span><br><span class="line"> -known /path/to/gatk/bundle/Mills_and_1000G_gold_standard.indels.b37.vcf \</span><br><span class="line"> -o sample_name.IndelRealigner.intervals</span><br><span class="line"></span><br><span class="line">java -jar /path/to/GenomeAnalysisTK.jar \</span><br><span class="line"> -T IndelRealigner \</span><br><span class="line"> -R /path/to/human.fasta \</span><br><span class="line"> -I sample_name.sorted.markdup.bam \</span><br><span class="line"> -known /path/to/gatk/bundle/1000G_phase1.indels.b37.vcf \</span><br><span class="line"> -known /path/to/gatk/bundle/Mills_and_1000G_gold_standard.indels.b37.vcf \</span><br><span class="line"> -o sample_name.sorted.markdup.realign.bam \</span><br><span class="line"> --targetIntervals sample_name.IndelRealigner.intervals</span><br></pre></td></tr></table></figure></li></ul><p>这一步中我们实际使用到的known indel集为：<br> Homo_sapiens_assembly38.known_indels.vcf<br> Mills_and_1000G_gold_standard.indels.hg38.vcf<br> 这些文件可以方便的在GATK bundle里面下载（<a href="ftp://ftp.broadinstitute.org/bundle/hg38/）" target="_blank" rel="noopener">ftp://ftp.broadinstitute.org/bundle/hg38/）</a>  </p><p> 后面的变异检测使用GATK，而且使用GATK的HaplotypeCaller模块或者是Mutect2模块时，当这个时候才可以减少这个Indel局部重比对的步骤。 </p><p> <strong>重新矫正碱基质量值</strong><br> 分为两步:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> gatk BaseRecalibrator \</span><br><span class="line">   -I my_reads.bam \</span><br><span class="line">   -R reference.fasta \</span><br><span class="line">   --known-sites sites_of_variation.vcf \</span><br><span class="line">   --known-sites another/optional/setOfSitesToMask.vcf \</span><br><span class="line">   -O recal_data.table</span><br><span class="line">## 用到的已知编译位点</span><br><span class="line">common_all_20180418_dbsnp_151_hg38.vcf</span><br><span class="line">Homo_sapiens_assembly38.known_indels.vcf</span><br><span class="line">Mills_and_1000G_gold_standard.indels.hg38.vcf</span><br><span class="line">下载地址（GATK的bundle以及1000genomic官网）：ftp://ftp.broadinstitute.org/bundle/hg38/</span><br><span class="line">https://ftp.ncbi.nlm.nih.gov/snp/organisms/</span><br></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gatk ApplyBQSR \</span><br><span class="line">  -R reference<span class="selector-class">.fasta</span> \</span><br><span class="line">  -I <span class="selector-tag">input</span><span class="selector-class">.bam</span> \</span><br><span class="line">  --bqsr-recal-file recalibration<span class="selector-class">.table</span> \</span><br><span class="line">  -O output.bam</span><br></pre></td></tr></table></figure><h6 id="MSI鉴定"><a href="#MSI鉴定" class="headerlink" title="MSI鉴定"></a>MSI鉴定</h6><p>通过以上步骤我么就获得了干净的bam文件可以用于下一步的MSI鉴定分析。<br>在此次鉴定中一共使用到了三种MSI鉴定软件用于鉴定我们的tumer-normal paired样本</p><p>** MSIsensor **  MSIsensor通过分别判断每个微卫星位点的稳定性，然后以不稳定微卫星位点的比例作为MSI得分。MSIsensor需要基于配对的肿瘤-正常样本进行MSI的判定。<br> 首先, 对于在肿瘤和正常样本中测序深度均大于等于20的微卫星位点, 计算其等位基因的分布信息; 其次, 通过卡方检验比较肿瘤和正常样本的相同微卫星位点的等位基因分布, 若显著不同, 则认为该微卫星位点不稳定; 最后统计不稳定位点的比例, 若该比例超过阈值, 则判定为MSI-H,这个阈值一般是3.5%<br> <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#重参考基因组中获取微卫星位点</span></span><br><span class="line">msisensor scan -d reference.fa -o microsatellites.list</span><br><span class="line"><span class="comment">#MSI扫描</span></span><br><span class="line">msisensor msi -d microsatellites.list -n normal.bam -t tumor.bam -e bed.file -o output.prefix</span><br></pre></td></tr></table></figure></p><p> 结果显示3个样本都是MSS<br>** MANTIS **<code>MANTIS</code>软件使用Python编辑，最新的版本2.7.1,但是Python3.0版本也是支持的<br>下载地址：<a href="https://github.com/OSU-SRLab/MANTIS" target="_blank" rel="noopener">https://github.com/OSU-SRLab/MANTIS</a><br>类似于MSIsensor, MANTIS也获得了肿瘤-正常配对样本在每个微卫星位点的等位基因分布信息; 与MSIsensor不同的是, 对于每个微卫星位点, MANTIS把上述两组数据看作两个向量, 定义这两个向量的 L1范数为样本中该位点的稳定程度, 对所有位点的L1范数求平均值即为样本的MSI得分</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#从参考基因组中获得微卫星位点</span></span><br><span class="line">./RepeatFinder –i /path/to/genome.fasta -o /path/to/loci.bed</span><br><span class="line"><span class="comment">#对上一步获得的微卫星位点根据exon测序实验室中的target位置信息进行过滤</span></span><br><span class="line">bedtools intersect -a MANTIS.loc.bed -b hg38_Regions.bed &gt; MANTIS_filter.bed</span><br><span class="line"><span class="comment">#进行MSI鉴定</span></span><br><span class="line">python mantis.py --bedfile /path/to/loci.bed --genome /path/to/genome.fasta -n /path/to/normal.bam -t /path/to/tumor.bam -o /path/to/output/file.txt</span><br></pre></td></tr></table></figure><p> 对于外显子测序，可使用以下不太严格的参数设置：<br> <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-mrq <span class="number">20.0</span></span><br><span class="line">-mlq <span class="number">25</span></span><br><span class="line">-mlc <span class="number">20</span></span><br><span class="line">-mrr <span class="number">1</span></span><br></pre></td></tr></table></figure></p><p> 结果显示3个样本都是MSS<br> ** VisualMSI **   通过模仿PCR来检测MSI。VisualMSI从参考基因组中提取PCR adapter，并将其map到测序read中。加入adapter可以成功的map到raed上，将计算这些adapter的插入长度。VisualMSI统计计算这些长度的分布情况。<br> <figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">visualmsi</span> -i tumor.sorted.<span class="keyword">bam </span>-n normal.sorted.<span class="keyword">bam </span>-r hg19.fasta -t targets/msi.tsv</span><br></pre></td></tr></table></figure></p><p> 关于target file<br> VisualMSI官网提供的参考文件为：</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#CHROM  POSITION  NAME</span><br><span class="line">chr4  <span class="number">55598216</span>  BAT25</span><br><span class="line">chr2  <span class="number">47641568</span>  BAT26</span><br><span class="line">chr14 <span class="number">23652365</span>  NR<span class="number">-21</span></span><br><span class="line">chr11 <span class="number">102193518</span> NR<span class="number">-27</span></span><br><span class="line">chr2  <span class="number">95849372</span>  NR<span class="number">-24</span></span><br></pre></td></tr></table></figure><p>但是他是根据hg19参考基因组来做的，我们需要将它转换为hg38参考基因组的,可以利用UCSC的liftover工具</p><ul><li>下载注释文件 <a href="https://hgdownload-test.gi.ucsc.edu/goldenPath/hg19/liftOver/" target="_blank" rel="noopener">https://hgdownload-test.gi.ucsc.edu/goldenPath/hg19/liftOver/</a>    中的hg19ToHg38.over.chain.gz文件</li><li>输入文件需要是标准的bed格式</li></ul><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">必须的字段：</span><br><span class="line">- 染色体</span><br><span class="line">- 起始位置（第一个氨基酸为<span class="number">0</span>）</span><br><span class="line">- 终止位置</span><br><span class="line">chr1  <span class="number">213941196</span>  <span class="number">213942363</span></span><br><span class="line">chr1  <span class="number">213942363</span>  <span class="number">213943530</span></span><br><span class="line">chr1  <span class="number">213943530</span>  <span class="number">213944697</span></span><br><span class="line">chr2  <span class="number">158364697</span>  <span class="number">158365864</span></span><br><span class="line">chr2  <span class="number">158365864</span>  <span class="number">158367031</span></span><br><span class="line">可选字段：name、score、strand....</span><br></pre></td></tr></table></figure><ul><li>进行转换<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../softwave/liftOver CRC_cancer-Specific_marker<span class="selector-class">.bed</span> hg19ToHg38<span class="selector-class">.over</span><span class="selector-class">.chain</span><span class="selector-class">.gz</span> hg38_CRC_cancer-Specific_marker<span class="selector-class">.tsv</span> unmap</span><br></pre></td></tr></table></figure></li></ul><p>不知道为什么大多数的position都显示能通过过滤标准的reads特别的少，不能通过质量控制，这个软件不适合？还是说参数设置不对？<br>** mSINGS **1) Catalog microsatellites present in your host genome.  There are a number of algorithms available to to this, but one we have found particularly easy to use is MISA (<a href="http://pgrc.ipk-gatersleben.de/misa/" target="_blank" rel="noopener">http://pgrc.ipk-gatersleben.de/misa/</a>).<br>2) Limit the list of microsatellites to those which are present in your capture design.  This can be done by converting the location of identified microsatellites from step #1 to BED file format, converting the coordinates of your capture design to BED file format, and using the BEDTOOLS intersect function to find where these two files overlap (<a href="http://bedtools.readthedocs.io/en/latest/content/tools/intersect.html" target="_blank" rel="noopener">http://bedtools.readthedocs.io/en/latest/content/tools/intersect.html</a>).<br>3) Generate support files and a baseline file from no fewer than 10-20 specimens, as detailed in the readme.<br>4) Examine the baseline file.  Identify any loci which have an average peak count of 1.0 / standard deviation of 0.0, as these loci may cause artifacts.  These should be removed from the baseline file and the original locus BED file.  The intervals file will need to be re-generated with the edited input BED file.<br>5) Perform mSINGS analysis of the individual files that you used to generate your baseline with the edited files.  Any remaining loci which are called as unstable in a measurable fraction (~10% or more) of known negative specimens should also be dropped due to their potential to cause artifacts.  Remove these loci and edit files as in step #4<br>6) Optional - if you have access to a number of known MSI positive specimens (10 or more), it can be helpful to analyze them at this point.  Discriminatory power of mSINGS can be improved if uninformative loci (those which are not unstable in 1 or more known MSI specimens) are removed from the panel.  You may remove uninformative loci as in step #4.  If these specimens are not available, be aware that an empirically-determined cutoff for discriminating MSS form MSI-H specimens may need to be established for your assay.  </p><p>mSINGs的使用流程：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##由于mSINGs是基于Python 2.7写的，所以首先要将shell切换到Python 2.7环境</span></span><br><span class="line"><span class="keyword">source</span> activate py2.7</span><br><span class="line">git clone https://bitbucket.org/uwlabmed/msings.git</span><br><span class="line">cd msings</span><br><span class="line">bash ./dev/bootstrap.sh</span><br><span class="line"><span class="comment">##切换到msings-env环境</span></span><br><span class="line"><span class="keyword">source</span> msings-env/bin/activate</span><br><span class="line"><span class="comment">##利用MANTIS软件中的获得的filter_bed（capture.bed的交集）文件进行下一步分析</span></span><br><span class="line">./scripts/create_intervals.sh ../../reference/mSINGS/MANTIS_filtered.bed</span><br><span class="line"><span class="comment">##创建msi_bed文件</span></span><br><span class="line">./scripts/create_baseline.sh ../../reference/mSINGS/normal_bamlist ../../reference/mSINGS/MANTIS_filtered.msi_intervals ../../reference/mSINGS/MANTIS_filtered.bed /data/reference/GRCh38/GRCh38.primary_assembly.genome.fa</span><br></pre></td></tr></table></figure><p>上面的到<code>MSI_BASELINE.txt</code>文件，筛选到其中<code>Standard_Deviation=0</code>的Position，这些Position被认为是没有意义的误差，然后与之前获得的<code>bed</code>文件取交集，获得有意义的bed文件<br>对normal样本进行MSI鉴定，对bed文件进行进一步的验证筛选</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./scripts/run_msings.sh</span><br><span class="line">          ../../reference/mSINGS/cancer_bamlist ../../reference/mSINGS/MANTIS_filtered<span class="selector-class">.filterSD</span><span class="selector-class">.msi_intervals</span></span><br><span class="line">          ../../reference/mSINGS/MANTIS_filtered<span class="selector-class">.filterSD</span><span class="selector-class">.bed</span> </span><br><span class="line">          /data/reference/GRCh38/GRCh38<span class="selector-class">.primary_assembly</span><span class="selector-class">.genome</span><span class="selector-class">.fa</span> </span><br><span class="line">          ../../reference/mSINGS/MSI_BASELINE_filterSD.txt</span><br></pre></td></tr></table></figure><p>根据获的<code>Combined_MSI.txt</code>结果，再从<code>MSI_BASELIEN_filterSD.txt</code>文件中删除掉在instable_num/total_num &gt; 10% 的position，同样的<code>bed</code>文件和<code>interval</code>也做相同的处理,得到最终的<code>MSI_BASELINE_filterSD_checknorm.txt</code><br>最后进行cancer样本的MSI鉴定</p><pre><code>./scripts/run_msings.sh          ../../reference/mSINGS/cancer_bamlist          ../../reference/mSINGS/MANTIS_filtered.filterSD.checknorm.msi_intervals          ../../reference/mSINGS/MANTIS_filtered.filterSD.checknorm.bed          /data/reference/GRCh38/GRCh38.primary_assembly.genome.fa           ../../reference/mSINGS/MSI_BASELINE_filterSD_checknorm.txt</code></pre><p>结果显示3个样本都是MSS的</p>]]></content>
      
      
      <categories>
          
          <category> Bioinformatic_project </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exome </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
